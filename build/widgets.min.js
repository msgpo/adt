(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.adt=t.adt||{};t.adt.widgets=t.adt.widgets||{};t.adt.widgets.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";function i(i,n,r,o){var s;try{if(o){s=o.append(r).attr("id","adt-widget-"+n+"-"+i).attr("class","adt-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{s=t.select("body").append(r).attr("id","adt-widget-"+n+"-"+i).attr("class","adt-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var l={relative:false,x:0,xDim:"px",y:0,yDim:"px",width:200,height:150,margins:{left:0,right:0,top:0,bottom:0},borders:{left:null,right:null,top:null,bottom:null},fontSize:10,fontColor:"white",fontWeight:"normal",_categories:{dim:["x","y","width","height","margins","fontSize"]},add:function(t,e,i,n,r){l[e]=i;t[e]=function(i){l[e]=i;if(r)r(i);return t};if(typeof n==="string"&&l._categories.hasOwnProperty(n)){l._categories[n].push(e)}}};var a=function(){function i(t){if(!t)return"";return t.replace(/ /g,"__")}function n(i,n){if(i===null||i===undefined||i.length<1){return{x:{min:0,max:1},y:{min:0,max:1}}}var r=[t.min(i,function(t){return t.x}),t.max(i,function(t){return t.x})];var o={};var s=[];i.forEach(function(t){if(!o.hasOwnProperty(t.x)){o[t.x]=1;s.push(t.x)}});var l=[];if(typeof i[0].y==="number"){l=[t.min(i,function(t){return t.y}),t.max(i,function(t){return t.y})]}else{var a=[],u=[];e.forOwn(i[0].y,function(e,n){a.push(t.min(i,function(t){return t.y[n]}));u.push(t.max(i,function(t){return t.y[n]}))});l=[t.min(a),t.max(u)]}var f={x:[null,null],y:[null,null]};if(n){e.forOwn(f,function(t,e){[0,1].forEach(function(i){t[i]=n.hasOwnProperty(e)&&n[e][i]!==null?n[e][i]:t[i]})})}return{x:{min:f.x[0]!==null?f.x[0]:r[0],max:f.x[1]!==null?f.x[1]:r[1],domain:s.filter(function(t){return(!f.x[0]||t>=f.x[0])&&(!f.x[1]||t<=f.x[1])})},y:{min:f.y[0]!==null?f.y[0]:l[0],max:f.y[1]!==null?f.y[1]:l[1],domain:[]}}}function r(e,i,n,r){function o(e,i){var n=null;if(typeof e){switch(e){case"number":default:n=t.scaleLinear().domain([i.min,i.max]);break;case"time":n=t.scaleTime().domain([i.min,i.max]);break;case"string":n=t.scaleBand().domain(i.domain).padding(.1);break}}return n}return{x:o(r&&r.x?r.x.type:"number",e.x).range(r&&r.x&&r.x.reverse?[i,0]:[0,i]),y:o(r&&r.y?r.y.type:"number",e.y).range(r&&r.y&&r.y.reverse?[0,n]:[n,0])}}function o(e,n,r){if(e!==null){if(typeof r==="string"){e.g.selectAll(n).style("opacity",function(){return t.select(this).classed(i(r))?1:.1})}else{e.g.selectAll(n).style("opacity",1)}}}return{encode:i,boundary:n,scale:r,highlight:o}}();this.resize=function(t){l.resize=t;return this};this.relative=function(){l.relative=true;return this};this.setClass=function(t){s.attr("class",t);return this};this.x=function(t,e){l.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)l.xDim=e;return this};this.y=function(t,e){l.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)l.yDim=e;return this};this.width=function(t){l.width=t;return this};this.height=function(t){l.height=t;return this};this.fontColor=function(t){l.fontColor=t;return this};this.fontSize=function(t){l.fontSize=t;return this};this.fontWeight=function(t){l.fontWeight=t;return this};this.margins=function(t){for(var e in t){if(l.margins.hasOwnProperty(e))l.margins[e]=t[e]}return this};this.borders=function(t){for(var e in t){if(l.borders.hasOwnProperty(e))l.borders[e]=t[e]}return this};var u={build:function(){throw new Error("adt.widgets.Widgets Error: build() is not implemented")},update:function(){throw new Error("adt.widgets.Widgets Error: update() is not implemented")},style:function(){throw new Error("adt.widgets.Widgets Error: style() is not implemented")}};this.render=function(t){var i=typeof t==="number"?t:500;if(typeof l.resize==="number"){l._categories.dim.forEach(function(t){if(t==="resize"||!l.hasOwnProperty(t))return;switch(typeof l[t]){case"number":if((t!=="x"||l.xDim!=="%")&&(t!=="y"||l.yDim!=="%"))l[t]*=l.resize;break;case"object":e.forOwn(l[t],function(e,i){if(typeof e==="number"){l[t][i]*=l.resize}});break;default:break}});l.resize=null}u.build(i);u.update(i);if(l.relative){s.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{s.style("position","absolute").style(l.x>=0?"left":"right",Math.abs(l.x)+l.xDim).style(l.y>=0?"top":"bottom",Math.abs(l.y)+l.yDim)}s.style("width",l.width+"px").style("height",l.height+"px");u.style(i);return this};this.describe=function(e){var i=null;s.on("contextmenu",function(){t.event.preventDefault();if(i===null){i=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").html(e);setTimeout(function(){if(i!==null){i.transition().duration(2e3).style("opacity",0).on("end",function(){t.select(this).remove();i=null})}},15e3)}}).on("mouseleave",function(){if(i!==null){i.remove();i=null}});return this};this.placeholder=function(e){var n=300;var r="adt-widget-placeholder-"+i;if(e){s.transition().duration(n).style("opacity",0);if(t.select("#"+r).empty()){var a=o?o:t.select("body");a.append("div").attr("id",r).style("position","absolute").style("width",l.width+"px").style("height",l.height+"px").style("line-height",l.height+"px").style(l.x>0?"left":"right",Math.abs(l.x)+l.xDim).style(l.y>0?"top":"bottom",Math.abs(l.y)+l.yDim).style("text-align","center").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",l.fontWeight).style("font-size",l.fontSize).style("color",l.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{s.transition().duration();s.transition().duration(n).style("opacity",1);var u=t.select("#"+r);if(!u.empty()){u.remove()}}};this.remove=function(){s.remove()};return{widget:s,attr:l,utils:a,render:u}}return i});