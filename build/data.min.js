(function(n,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],t)}else{n.adt=n.adt||{};n.adt.data=t(n._)}})(this,function(n){"use strict";var t={si:function(){var n="yzafpnÎ¼m kMGTPEZY";var t=(n.length-1)/2;var r=t;var e=-t;function u(u){if(u===null||u===undefined||isNaN(u))return"N/A";if(u===0)return"0";var i=Math.abs(u);var o=Math.max(Math.min(parseInt(Math.floor(Math.log(i)/Math.log(1e3))),r),e);var a=i/Math.pow(1e3,o);return(u<0?"-":"")+(o===e||o===r?a.toExponential(2):a.toPrecision(3)).replace(/e\+0$/,"")+n.charAt(t+o).trim()}return u}(),idfy:function(n){return n?n.replace(/ /g,"__"):""},namify:function(n){return n?n.replace(/__/g," "):""}};var r={sum:function(t,r,e){var u={};var i=[];if(Array.isArray(e)){i=e}else{i=[e]}var o=i.length;t.forEach(function(n){var t=[];i.forEach(function(r){if(n.hasOwnProperty(r)){t.push(n[r])}});if(t.length!==o)return;var e=t.join(".");if(!u.hasOwnProperty(e))u[e]=+n[r];else u[e]+=+n[r]});var a=[];n.forOwn(u,function(n,t){a.push({key:t,value:n})});return a.sort(function(n,t){return t.value-n.value})}};var e={Histogram:function(t){var r=t?t:[];this.set=function(n){r=n;return this};function e(){return n.cloneDeep(r)}function u(n,t){r.push({x:n,y:t,index:r.length});return this}function i(n){r.forEach(function(t){t.y*=n});return this}function o(){var n=d3.sum(r,function(n){return n.y});r.forEach(function(t){t.y/=n});return this}function a(n){r.sort(function(t,r){return n?r.x-t.x:t.x-r.x});return this}function f(n){r.sort(function(t,r){return n?r.y-t.y:t.y-r.y});return this}function c(){r.sort(function(n,t){return n.index-t.index});return this}return{set:set,get:e,add:u,scale:i,normalize:o,sortByX:a,sortByY:f,unsort:c}},TimeSeries:function(t){var r=[];function e(n){r=[];var e=0;if(n!==null){var u=new Date(n);while(u<=new Date){r.push({x:new Date(u),y:{}});t.forEach(function(n){r[e].y[n]=0});u.setDate(u.getDate()+1);e++}}return this}function u(n,t,e,u){r[n].x=t;r[n].y[e]+=u}function i(n,t){if(!n)return r;else{var e=t?t:0;return r.slice(-e-n,-e)}}function o(t,e){if(r.length<1)return{};var u={};n.forOwn(r[0].y,function(n,t){u[t]=0});i(t?t:1,e).forEach(function(t){n.forOwn(r[0].y,function(n,r){u[r]+=t.y[r]})});return u}function a(t,e){var u=0;if(r.length>0){var o=i(t,e);n.forOwn(r[0].y,function(n,t){u=Math.max(d3.max(o,function(n){return n.y.hasOwnProperty(t)?n.y[t]:0}),u)})}return u}function f(t){if(r.length<1)return{};var e=o(1,t);var u=o(2,t);var i={};n.forOwn(r[0].y,function(n,t){u[t]-=e[t];if(u[t]>=10&&e[t]>0){i[t]=(e[t]-u[t])/u[t]}});return i}function c(t,r){var e=o(t,r);var u=0;n.forOwn(e,function(n){u+=n});n.forOwn(e,function(n,t){e[t]/=u>0?u:1});return e}return{clear:e,update:u,sub:i,sum:o,peak:a,trend:f,yDist:c}},Table:function(t){var r=[];var e=[];if(t){r=n.cloneDeep(t);r.forEach(function(n,t){e.push(t)})}function u(n,t){var e=[];r.forEach(function(r){var u;if(typeof t==="string"){u=r[t]}else{u={};t.forEach(function(n){u[n]=r[n]})}e.push({x:r[n],y:u})});return e}function i(n,t){var e=null;switch(typeof t){case"number":var u=d3.min(r,function(r){return Math.abs((t-r[n])/t)});e=r.filter(function(r){return Math.abs((r[n]-t)/t)<=u*1.01});break;case"string":default:e=r.filter(function(r){return r[n]===t})}return new adt.data.structures.Table(e)}function o(n){r.sort(function(t,r){return t[n]-r[n]});return this}function a(){var n=[];e.forEach(function(t){n.push(r[t])});r=n}return{slice:u,segment:i,sort:o,unsort:a}}};return{format:t,explore:r,structures:e}});