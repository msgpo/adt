(function(t,r){if(typeof exports==="object"&&typeof module!=="undefined"){r(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],r)}else{r(t.adt=t.adt||{})}})(this,function(t){"use strict";if(t.widgets){var r=t.widgets}else{throw new Error("adt.widgets.linechart Error: widgets module is not exported")}function e(t,e){var a=r.Widget.call(this,t,"lineChart","svg",e);a.attr.add(this,"xLabel","");a.attr.add(this,"yLabel","");a.attr.add(this,"xType","number");a.attr.add(this,"yTickFormat",d3.format(".2s"));a.attr.add(this,"colors","grey");a.attr.add(this,"legend",false);a.attr.add(this,"yMin",0);a.attr.add(this,"mouseover",null);a.attr.add(this,"mouseleave",null);var n=null;var s=[];var o=1;var i=[];this.data=function(t,r){s=_.cloneDeep(t);if(a.attr.xType==="number"||a.attr.xType==="time"){s.sort(function(t,r){return t.x-r.x})}if(typeof r==="number"&&r>0)o=r;return this};this.highlight=function(t){a.utils.highlight(n,".line",t)};var l=this.highlight;this.addMarker=function(t,r,e,o,l){if(i.hasOwnProperty(t)){return null}var y=s.filter(function(t){return t.x-e===0})[0];if(!y||!y.hasOwnProperty("y")||!y.y.hasOwnProperty(r))return null;var c=y.y[r];var f=s.filter(function(t){return t.x-o===0})[0];if(!f||!f.hasOwnProperty("y")||!f.y.hasOwnProperty(r))return null;var d=f.y[r];var p=typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r];var u=c<d?e:o;var x=c<d?d:c;var h=n.g.append("g").attr("class","marker");h.append("line").attr("x1",n.scale.x(e)+2).attr("y1",n.scale.y(x)).attr("x2",n.scale.x(o)+2).attr("y2",n.scale.y(x)).style("stroke",p).style("stroke-dasharray","3 3").style("stroke-width",2);h.append("line").attr("x1",n.scale.x(u)+2).attr("y1",n.scale.y(c)).attr("x2",n.scale.x(u)+2).attr("y2",n.scale.y(d)).style("stroke",p).style("stroke-dasharray","3 3").style("stroke-width",2);h.append("circle").attr("cx",n.scale.x(e)+2).attr("cy",n.scale.y(c)).attr("r",4).style("stroke","none").style("fill",p);h.append("circle").attr("cx",n.scale.x(o)+2).attr("cy",n.scale.y(d)).attr("r",4).style("stroke","none").style("fill",p);h.append("text").attr("x",n.scale.x(u)+2).attr("y",n.scale.y(x)).attr("dy",-5).attr("text-anchor",c<d?"start":"end").style("fill",a.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(l);i[t]=h;return h};this.removeMarker=function(t){if(i.hasOwnProperty(t)){i[t].remove();delete i[t];return true}return false};a.render.build=function(){if(n!==null)return;n={};n.g=a.widget.append("g");n.axisFn={x:d3.axisBottom().ticks(7),y:d3.axisLeft().ticks(5).tickFormat(a.attr.yTickFormat)};n.axes={x:n.g.append("g").attr("class","x axis").attr("font-family","inherit"),y:n.g.append("g").attr("class","y axis").attr("font-family","inherit")};n.labels={x:n.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("font-family","inherit").attr("stroke-width",0),y:n.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("font-family","inherit").attr("stroke-width",0)};n.errors={};_.forOwn(s[0].y,function(t,r){n.errors[r]=n.g.append("path").attr("class","error "+a.utils.encode(r)).style("fill-opacity",.2).style("stroke-width","0px").style("shape-rendering","geometricPrecision")});n.lines={};_.forOwn(s[0].y,function(t,r){n.lines[r]=n.g.append("path").attr("class","line "+a.utils.encode(r)).style("fill","none").style("stroke-width","2px").style("shape-rendering","geometricPrecision")});if(a.attr.legend){var t=n.g.append("g").attr("class","legend");var r=0;_.forOwn(n.lines,function(e,n){var s=t.append("g").style("cursor","pointer").on("mouseover",function(){l(n)}).on("mouseleave",function(){l()});s.append("rect").attr("x",a.attr.width*.8).attr("y",r).attr("width",a.attr.fontSize).attr("height",a.attr.fontSize).style("fill",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[n]).style("stroke","none");s.append("text").attr("x",a.attr.width*.83).attr("y",r).attr("dy",.8*a.attr.fontSize).attr("text-anchor","start").style("fill",a.attr.fontColor).attr("font-family","inherit").attr("font-size",a.attr.fontSize+"px").text(n);r+=a.attr.height*.08})}};a.render.update=function(t){var r=_.cloneDeep(s);for(var e=0;e<r.length;e++){for(var i in r[e].y){if(r[e].y.hasOwnProperty(i))r[e].y[i]/=o;if(r[e].hasOwnProperty("dy")){if(r[e].dy.hasOwnProperty(i))r[e].dy[i]/=o}}}n.scale=a.utils.scale(a.utils.boundary(r,{y:[a.attr.yMin,null]}),a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom,{x:{type:a.attr.xType}});n.axes.x.transition().duration(t).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(t).call(n.axisFn.y.scale(n.scale.y));_.forOwn(r[0].y,function(e,a){if(r[0].hasOwnProperty("dy")&&r[0].dy.hasOwnProperty(a)){var s=d3.area().x(function(t){return scale.x(t.x)+2}).y0(function(t){return scale.y(t.y[a]-t.dy[a])}).y1(function(t){return scale.y(t.y[a]+t.dy[a])});n.errors[a].transition().duration(t).attr("d",s(r))}var o=d3.line().x(function(t){return n.scale.x(t.x)+2}).y(function(t){return n.scale.y(t.y[a])});n.lines[a].transition().duration(t).attr("d",o(r))})};a.render.style=function(){var t=a.attr.width-a.attr.margins.left-a.attr.margins.right,r=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;n.g.attr("width",t+"px").attr("height",r+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");n.axes.x.attr("transform","translate(0,"+r+")");n.axisFn.y.tickFormat(a.attr.yTickFormat);n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".axis path").style("fill","none").style("stroke",a.attr.fontColor).style("stroke-width","2px").style("shape-rendering","crispEdges");n.g.selectAll(".tick > line").style("stroke",a.attr.fontColor).style("stroke-width","2px");n.g.selectAll(".tick > text").attr("stroke-width",0).style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor);n.labels.x.attr("x",t+"px").attr("y",r+35+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.yLabel);_.forOwn(n.errors,function(t,r){n.errors[r].style("fill",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(r)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(r)})});_.forOwn(n.lines,function(t,r){n.lines[r].style("stroke",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(r)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(r)})});a.widget.style("display","block")}}e.prototype=Object.create(r.Widget.prototype);t.widgets.LineChart=e});