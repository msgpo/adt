(function(t,r){if(typeof exports==="object"&&typeof module!=="undefined"){r(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],r)}else{r(t.adt=t.adt||{})}})(this,function(t){"use strict";if(t.widgets){var r=t.widgets}else{throw new Error("adt.widgets.linechart Error: widgets module is not exported")}function e(t,e){var a=r.Widget.call(this,t,"lineChart","svg",e);a.attr.add(this,"xLabel","");a.attr.add(this,"yLabel","");a.attr.add(this,"xType","number");a.attr.add(this,"yTickFormat",d3.format(".2s"));a.attr.add(this,"colors","grey");a.attr.add(this,"yMin",0);a.attr.add(this,"mouseover",null);a.attr.add(this,"mouseleave",null);var s=null;var n=[];var o=1;var i=[];this.data=function(t,r){n=_.cloneDeep(t);if(a.attr.xType==="number"||a.attr.xType==="time"){n.sort(function(t,r){return t.x-r.x})}if(typeof r==="number"&&r>0)o=r;return this};this.highlight=function(t){a.utils.highlight(s,".line",t)};this.addMarker=function(t,r,e,o,l){if(i.hasOwnProperty(t)){return null}var y=n.filter(function(t){return t.x===e})[0];if(!y||!y.hasOwnProperty("y")||!y.y.hasOwnProperty(r))return null;var c=y.y[r];var f=n.filter(function(t){return t.x===o})[0];if(!f||!f.hasOwnProperty("y")||!f.y.hasOwnProperty(r))return null;var d=f.y[r];var p=typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r];var u=c<d?e:o;var x=c<d?d:c;var h=s.g.append("g").attr("class","marker");h.append("line").attr("x1",s.scale.x(e)+2).attr("y1",s.scale.y(x)).attr("x2",s.scale.x(o)+2).attr("y2",s.scale.y(x)).style("stroke",p).style("stroke-dasharray","3 3").style("stroke-width",2);h.append("line").attr("x1",s.scale.x(u)+2).attr("y1",s.scale.y(c)).attr("x2",s.scale.x(u)+2).attr("y2",s.scale.y(d)).style("stroke",p).style("stroke-dasharray","3 3").style("stroke-width",2);h.append("circle").attr("cx",s.scale.x(e)+2).attr("cy",s.scale.y(c)).attr("r",4).style("stroke","none").style("fill",p);h.append("circle").attr("cx",s.scale.x(o)+2).attr("cy",s.scale.y(d)).attr("r",4).style("stroke","none").style("fill",p);h.append("text").attr("x",s.scale.x(u)+2).attr("y",s.scale.y(x)).attr("dy",-5).attr("text-anchor",c<d?"start":"end").style("fill",a.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(l);i[t]=h;return h};this.removeMarker=function(t){if(i.hasOwnProperty(t)){i[t].remove();delete i[t];return true}return false};a.render.build=function(){if(s!==null)return;s={};s.g=a.widget.append("g");s.axisFn={x:d3.axisBottom().ticks(7),y:d3.axisLeft().ticks(5).tickFormat(a.attr.yTickFormat)};s.axes={x:s.g.append("g").attr("class","x axis").attr("font-family","inherit"),y:s.g.append("g").attr("class","y axis").attr("font-family","inherit")};s.labels={x:s.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("font-family","inherit").attr("stroke-width",0),y:s.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("font-family","inherit").attr("stroke-width",0)};s.errors={};_.forOwn(n[0].y,function(t,r){s.errors[r]=s.g.append("path").attr("class","error "+a.utils.encode(r)).style("fill-opacity",.2).style("stroke-width","0px").style("shape-rendering","geometricPrecision")});s.lines={};_.forOwn(n[0].y,function(t,r){s.lines[r]=s.g.append("path").attr("class","line "+a.utils.encode(r)).style("fill","none").style("stroke-width","2px").style("shape-rendering","geometricPrecision")})};a.render.update=function(t){var r=_.cloneDeep(n);for(var e=0;e<r.length;e++){for(var i in r[e].y){if(r[e].y.hasOwnProperty(i))r[e].y[i]/=o;if(r[e].hasOwnProperty("dy")){if(r[e].dy.hasOwnProperty(i))r[e].dy[i]/=o}}}s.scale=a.utils.scale(a.utils.boundary(r,{y:[a.attr.yMin,null]}),a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom,{x:{type:a.attr.xType}});s.axes.x.transition().duration(t).call(s.axisFn.x.scale(s.scale.x));s.axes.y.transition().duration(t).call(s.axisFn.y.scale(s.scale.y));_.forOwn(r[0].y,function(e,a){if(r[0].hasOwnProperty("dy")&&r[0].dy.hasOwnProperty(a)){var n=d3.area().x(function(t){return scale.x(t.x)+2}).y0(function(t){return scale.y(t.y[a]-t.dy[a])}).y1(function(t){return scale.y(t.y[a]+t.dy[a])});s.errors[a].transition().duration(t).attr("d",n(r))}var o=d3.line().x(function(t){return s.scale.x(t.x)+2}).y(function(t){return s.scale.y(t.y[a])});s.lines[a].transition().duration(t).attr("d",o(r))})};a.render.style=function(){var t=a.attr.width-a.attr.margins.left-a.attr.margins.right,r=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;s.g.attr("width",t+"px").attr("height",r+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");s.axes.x.attr("transform","translate(0,"+r+")");s.axisFn.y.tickFormat(a.attr.yTickFormat);s.axes.y.attr("transform","translate(0,"+1+")");s.g.selectAll(".axis path").style("fill","none").style("stroke",a.attr.fontColor).style("stroke-width","2px").style("shape-rendering","crispEdges");s.g.selectAll(".tick > line").style("stroke",a.attr.fontColor).style("stroke-width","2px");s.g.selectAll(".tick > text").attr("stroke-width",0).style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor);s.labels.x.attr("x",t+"px").attr("y",r+35+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.xLabel);s.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.yLabel);_.forOwn(s.errors,function(t,r){s.errors[r].style("fill",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(r)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(r)})});_.forOwn(s.lines,function(t,r){s.lines[r].style("stroke",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[r]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(r)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(r)})});a.widget.style("display","block")}}e.prototype=Object.create(r.Widget.prototype);t.widgets.LineChart=e});