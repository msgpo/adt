(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){e(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{e(t.adt=t.adt||{})}})(this,function(t){"use strict";function e(t,e,n,i){var r;if(i){r=i.append(n).attr("id","adt-widget-"+e+"-"+t).attr("class","adt-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{r=d3.select("body").append(n).attr("id","adt-widget-"+e+"-"+t).attr("class","adt-widget").style("display","none").style("position","absolute").style("pointer-events","none")}var o={relative:false,x:0,xDim:"px",y:0,yDim:"px",width:200,height:150,margins:{left:0,right:0,top:0,bottom:0},borders:{left:null,right:null,top:null,bottom:null},fontSize:10,fontColor:"white",fontWeight:"normal",_categories:{dim:["x","y","width","height","margins","fontSize"]},add:function(t,e,n,i,r){o[e]=n;t[e]=function(n){o[e]=n;if(r)r(n);return t};if(typeof i==="string"&&o._categories.hasOwnProperty(i)){o._categories[i].push(e)}}};var s=function(){function t(t){if(!t)return"";return t.replace(/ /g,"__")}function e(t,e){if(t===null||t===undefined||t.length<1){return{x:{min:0,max:1},y:{min:0,max:1}}}var n=[d3.min(t,function(t){return t.x}),d3.max(t,function(t){return t.x})];var i={};var r=[];t.forEach(function(t){if(!i.hasOwnProperty(t.x)){i[t.x]=1;r.push(t.x)}});var o=[];if(typeof t[0].y==="number"){o=[d3.min(t,function(t){return t.y}),d3.max(t,function(t){return t.y})]}else{var s=[],l=[];_.forOwn(t[0].y,function(e,n){s.push(d3.min(t,function(t){return t.y[n]}));l.push(d3.max(t,function(t){return t.y[n]}))});o=[d3.min(s),d3.max(l)]}var a={x:[null,null],y:[null,null]};if(e){_.forOwn(a,function(t,n){[0,1].forEach(function(i){t[i]=e.hasOwnProperty(n)&&e[n][i]!==null?e[n][i]:t[i]})})}return{x:{min:a.x[0]!==null?a.x[0]:n[0],max:a.x[1]!==null?a.x[1]:n[1],domain:r.filter(function(t){return(!a.x[0]||t>=a.x[0])&&(!a.x[1]||t<=a.x[1])})},y:{min:a.y[0]!==null?a.y[0]:o[0],max:a.y[1]!==null?a.y[1]:o[1],domain:[]}}}function n(t,e,n,i){function r(t,e){var n=null;if(typeof t){switch(t){case"number":default:n=d3.scaleLinear().domain([e.min,e.max]);break;case"time":n=d3.scaleTime().domain([e.min,e.max]);break;case"string":n=d3.scaleBand().domain(e.domain).padding(.1);break}}return n}return{x:r(i&&i.x?i.x.type:"number",t.x).range(i&&i.x&&i.x.reverse?[e,0]:[0,e]),y:r(i&&i.y?i.y.type:"number",t.y).range(i&&i.y&&i.y.reverse?[0,n]:[n,0])}}function i(e,n,i){if(e!==null){if(typeof i==="string"){e.g.selectAll(n).style("opacity",function(){return d3.select(this).classed(t(i))?1:.1})}else{e.g.selectAll(n).style("opacity",1)}}}return{encode:t,boundary:e,scale:n,highlight:i}}();this.resize=function(t){o.resize=t;return this};this.relative=function(){o.relative=true;return this};this.setClass=function(t){r.attr("class",t);return this};this.x=function(t,e){o.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)o.xDim=e;return this};this.y=function(t,e){o.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)o.yDim=e;return this};this.width=function(t){o.width=t;return this};this.height=function(t){o.height=t;return this};this.fontColor=function(t){o.fontColor=t;return this};this.fontSize=function(t){o.fontSize=t;return this};this.fontWeight=function(t){o.fontWeight=t;return this};this.margins=function(t){for(var e in t){if(o.margins.hasOwnProperty(e))o.margins[e]=t[e]}return this};this.borders=function(t){for(var e in t){if(o.borders.hasOwnProperty(e))o.borders[e]=t[e]}return this};var l={build:function(){throw new Error("adt.widgets.Widgets Error: build() is not implemented")},update:function(){throw new Error("adt.widgets.Widgets Error: update() is not implemented")},style:function(){throw new Error("adt.widgets.Widgets Error: style() is not implemented")}};this.render=function(t){var e=typeof t==="number"?t:500;if(typeof o.resize==="number"){o._categories.dim.forEach(function(t){if(t==="resize"||!o.hasOwnProperty(t))return;switch(typeof o[t]){case"number":if((t!=="x"||o.xDim!=="%")&&(t!=="y"||o.yDim!=="%"))o[t]*=o.resize;break;case"object":_.forOwn(o[t],function(e,n){if(typeof e==="number"){o[t][n]*=o.resize}});break;default:break}});o.resize=null}l.build(e);l.update(e);if(o.relative){r.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{r.style("position","absolute").style(o.x>=0?"left":"right",Math.abs(o.x)+o.xDim).style(o.y>=0?"top":"bottom",Math.abs(o.y)+o.yDim)}r.style("width",o.width+"px").style("height",o.height+"px");l.style(e);return this};this.describe=function(t){var e=null;r.on("contextmenu",function(){d3.event.preventDefault();if(e===null){e=d3.select("body").append("div").style("position","absolute").style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").html(t);setTimeout(function(){if(e!==null){e.transition().duration(2e3).style("opacity",0).on("end",function(){d3.select(this).remove();e=null})}},15e3)}}).on("mouseleave",function(){if(e!==null){e.remove();e=null}});return this};this.placeholder=function(e){var n=300;var s="adt-widget-placeholder-"+t;if(e){r.transition().duration(n).style("opacity",0);if(d3.select("#"+s).empty()){var l=i?i:d3.select("body");l.append("div").attr("id",s).style("position","absolute").style("width",o.width+"px").style("height",o.height+"px").style("line-height",o.height+"px").style(o.x>0?"left":"right",Math.abs(o.x)+o.xDim).style(o.y>0?"top":"bottom",Math.abs(o.y)+o.yDim).style("text-align","center").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",o.fontWeight).style("font-size",o.fontSize).style("color",o.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{r.transition().duration();r.transition().duration(n).style("opacity",1);var a=d3.select("#"+s);if(!a.empty()){a.remove()}}};this.remove=function(){r.remove()};return{widget:r,attr:o,utils:s,render:l}}if(!t.widgets)var n=t.widgets={};n.Widget=e});