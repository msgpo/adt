(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){e(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{e(t.adt=t.adt||{})}})(this,function(t){"use strict";if(t.widgets){var e=t.widgets}else{throw new Error("adt.widgets.chordchart Error: widgets module is not exported")}function r(t,r){var n=e.Widget.call(this,t,"chordChart","svg",r);n.attr.add(this,"radius",100,"dim");n.attr.add(this,"thickness",10,"dim");n.attr.add(this,"label","");n.attr.add(this,"ticks",false);n.attr.add(this,"colors",null);n.attr.add(this,"mouseover",null);n.attr.add(this,"mouseleave",null);n.attr.add(this,"invert",false);var a=null;var i=[];var o=d3.map();var s=d3.map();var u=10;var d=null;this.data=function(t){o.clear();s.clear();i=[];var e=0,r=0;t.forEach(function(t){if(!o.has(r=t.source)){s.set(e,r);o.set(r,e++)}if(!o.has(r=t.target)){s.set(e,r);o.set(r,e++)}});t.forEach(function(t){var r=o.get(t.source),n=o.get(t.target),a=i[r];if(!a){a=i[r]=[];for(var s=0;s<e;s++)a[s]=0}a[n]=t.value;if(!i[n]){i[n]=[];for(s=0;s<e;s++)i[n][s]=0}});u=d3.max(s.values(),function(t){return t.length});return this};function l(t){var e={};var r=d3.scaleOrdinal(d3.schemeCategory10);t.forEach(function(t){e[s.get(t.index)]=r(t.index)});return e}function c(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function f(t){var e=d3.map();if(t){t.groups.forEach(function(t){e.set(t.index,t)})}return function(t){var r;var n=e.get(t.index);if(n){r=d3.interpolate(n,t)}else{var i={startAngle:t.startAngle,endAngle:t.startAngle};r=d3.interpolate(i,t)}return function(t){return a.arc(r(t))}}}function g(t){var e=d3.map();if(t){t.forEach(function(t){e.set(c(t),t)})}return function(r){var n;var i=e.get(c(r));if(i){if(r.source.index!==i.source.index){i={source:i.target,target:i.source}}n=d3.interpolate(i,r)}else{if(t){var o=t.groups.filter(function(t){return t.index===r.source.index||t.index===r.target.index});i={source:o[0],target:o[1]||o[0]};if(i.source&&r.source.index!==i.source.index){i={source:i.target,target:i.source}}}else i=r;var s=i.source?i.source.startAngle:0;var u=i.target?i.target.startAngle:0;var d={source:{startAngle:s,endAngle:s},target:{startAngle:u,endAngle:u}};n=d3.interpolate(d,r)}return function(t){return a.ribbonFn(n(t))}}}this.highlight=function(t){n.utils.highlight(a,".ribbon",t)};n.render.build=function(){if(a!==null)return;a={};a.g=n.widget.append("g");a.chordFn=d3.chord().padAngle(.05).sortGroups(d3.descending).sortSubgroups(d3.descending);a.arc=d3.arc();a.ribbonFn=d3.ribbon();a.label=a.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};n.render.update=function(t){if(a.groups)a.groups.transition();if(a.newGroups)a.newGroups.transition();if(a.ribbons)a.ribbons.transition();if(a.newRibbons)a.newRibbons.transition();a.chord=a.chordFn(i);if(n.attr.colors===null){n.attr.colors=l(a.chord.groups)}a.arc.innerRadius(n.attr.radius).outerRadius(n.attr.radius+n.attr.thickness);a.groups=a.g.selectAll(".group").data(a.chord.groups,function(t){return t.index});a.newGroups=a.groups.enter().append("g").each(function(t){t.name=s.get(t.index)}).attr("class","group").style("pointer-events","all").on("mouseover",function(t,e){if(n.attr.mouseover){n.attr.mouseover(t.name,e)}}).on("mouseleave",function(t,e){if(n.attr.mouseleave){n.attr.mouseleave(t.name,e)}});a.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return n.attr.colors[t.name]}).transition().duration(t).attrTween("d",f(d));if(n.attr.ticks){a.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(n.attr.radius+n.attr.thickness+10)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"}).style("font-size",n.attr.fontSize*.6+"px").style("font-weight",n.attr.fontWeight).style("fill",n.attr.fontColor)}a.groups.exit().transition().duration(t).style("opacity",0).remove();a.groups.select("path").each(function(t){t.name=s.get(t.index)}).attr("d",a.arc).transition().duration(t).style("fill",function(t){return n.attr.colors[t.name]}).attrTween("d",f(d));if(n.attr.ticks){a.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(n.attr.radius+n.attr.thickness+10)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}a.ribbonFn.radius(n.attr.radius);a.ribbons=a.g.selectAll(".ribbon").data(a.chord,c);a.newRibbons=a.ribbons.enter().append("path").each(function(t){t.source.name=s.get(t.source.index);t.target.name=s.get(t.target.index)}).attr("class",function(t){return"ribbon "+n.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return n.attr.colors[n.attr.invert?t.source.name:t.target.name]}).style("stroke-width","2px").style("stroke","white");a.newRibbons.transition().duration(t).attrTween("d",g(null));a.ribbons.exit().transition().duration(t).style("opacity",0).remove();a.ribbons.each(function(t){t.source.name=s.get(t.source.index);t.target.name=s.get(t.target.index)}).attr("class",function(t){return"ribbon "+n.utils.encode(t.source.name)}).transition().duration(t).style("fill",function(t){return n.attr.colors[n.attr.invert?t.source.name:t.target.name]}).attrTween("d",g(d));d=a.chord};n.render.style=function(){var t=n.attr.ticks?u*n.attr.fontSize*.8:0;n.attr.width=t+2*(n.attr.radius+n.attr.thickness);n.attr.height=t+20+2*(n.attr.radius+n.attr.thickness);n.widget.style("width",n.attr.width+"px").style("height",n.attr.height+"px");a.g.attr("transform","translate("+n.attr.width/2+","+n.attr.height/2+")");a.label.attr("transform","translate(0,"+(15+n.attr.radius+n.attr.thickness)+")").style("width",2*(n.attr.radius+n.attr.thickness)+"px").attr("font-family","inherit").attr("font-size",n.attr.fontSize+"px").style("fill",n.attr.fontColor).text(n.attr.label);n.widget.style("display","block")}}r.prototype=Object.create(e.Widget.prototype);t.widgets.ChordChart=r});